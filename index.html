<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Lembur Bulanan</title>
<style>
/* === GAYA TETAP SAMA === */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);padding:20px;min-height:100vh}
.container{max-width:1400px;margin:0 auto;background:#fff;border-radius:15px;box-shadow:0 10px 40px rgba(0,0,0,0.2);overflow:hidden}
.header{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:30px;text-align:center}
.header h1{font-size:28px;margin-bottom:10px}
.controls{padding:20px 30px;background:#f8f9fa;border-bottom:2px solid #e9ecef}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:15px}
.input-group{display:flex;flex-direction:column;gap:5px}
.input-group.full-width{grid-column:1/-1}
.input-group label{font-size:12px;font-weight:600;color:#495057}
.input-group input,.input-group select,.input-group textarea{padding:8px 12px;border:2px solid #dee2e6;border-radius:6px;font-size:14px;transition:border-color .3s;font-family:inherit}
.input-group textarea{resize:vertical;min-height:60px}
.input-group input:focus,.input-group select:focus,.input-group textarea:focus{outline:none;border-color:#667eea}
.file-input-wrapper{position:relative;display:inline-block;width:100%}
.file-input-wrapper input[type=file]{position:absolute;opacity:0;width:100%;height:100%;cursor:pointer}
.file-input-label{display:flex;align-items:center;gap:10px;padding:8px 12px;border:2px dashed #dee2e6;border-radius:6px;background:white;cursor:pointer;transition:.3s}
.file-input-label:hover{border-color:#667eea;background:#f8f9fa}
.file-preview{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
.preview-item{position:relative;width:100px;height:100px;border:2px solid #dee2e6;border-radius:6px;overflow:hidden}
.preview-item img{width:100%;height:100%;object-fit:cover}
.preview-remove{position:absolute;top:5px;right:5px;background:#dc3545;color:white;border:none;border-radius:50%;width:20px;height:20px;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center}
.button-group{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}
button{padding:10px 20px;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:.3s;font-size:14px}
.btn-add{background:#667eea;color:white}.btn-add:hover{background:#5568d3;transform:translateY(-2px)}
.btn-export{background:#28a745;color:white}.btn-export:hover{background:#218838;transform:translateY(-2px)}
.btn-clear{background:#6c757d;color:white}.btn-clear:hover{background:#5a6268}
.btn-delete{background:#dc3545;color:white;padding:5px 10px;font-size:12px}.btn-delete:hover{background:#c82333}
.btn-view{background:#17a2b8;color:white;padding:5px 10px;font-size:12px}.btn-view:hover{background:#138496}
.table-container{padding:30px;overflow-x:auto}
table{width:100%;border-collapse:collapse}
th{background:#667eea;color:white;padding:12px;text-align:left;font-weight:600;font-size:13px;white-space:nowrap}
td{padding:12px;border-bottom:1px solid #e9ecef;font-size:14px}
tr:hover{background:#f8f9fa}
.summary{padding:20px 30px;background:#f8f9fa;border-top:2px solid #e9ecef;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}
.summary-item{background:white;padding:15px;border-radius:8px;border-left:4px solid #667eea}
.summary-item label{font-size:12px;color:#6c757d;font-weight:600;display:block;margin-bottom:5px}
.summary-item .value{font-size:24px;font-weight:bold;color:#667eea}
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.8);align-items:center;justify-content:center}
.modal.active{display:flex}
.modal-content{background:white;padding:20px;border-radius:10px;max-width:90%;max-height:90%;overflow:auto;position:relative}
.modal-close{position:absolute;top:10px;right:10px;background:#dc3545;color:white;border:none;border-radius:50%;width:30px;height:30px;cursor:pointer;font-size:18px}
.modal-images{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:40px}
.modal-images img{width:100%;border-radius:8px;border:2px solid #dee2e6}
.save-indicator{position:fixed;bottom:20px;right:20px;background:#28a745;color:white;padding:10px 20px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.3);display:none}
</style>
</head>
<body>
<div class="container">
<div class="header"><h1>üìä Laporan Lembur Bulanan</h1><p>Catat lembur Anda dan kumpulkan bukti</p></div>

<div class="controls">
  <div class="form-grid">
    <div class="input-group"><label>Bulan & Tahun *</label><input type="month" id="bulanTahun"></div>
    <div class="input-group"><label>Tanggal Lembur *</label><input type="date" id="tanggal"></div>
    <div class="input-group"><label>Jam Mulai *</label><input type="time" id="jamMulai"></div>
    <div class="input-group"><label>Jam Selesai *</label><input type="time" id="jamSelesai"></div>
    <div class="input-group full-width"><label>Deskripsi Pekerjaan *</label><textarea id="deskripsi"></textarea></div>
    <div class="input-group full-width">
      <label>Upload Bukti Screenshot</label>
      <div class="file-input-wrapper"><input type="file" id="buktiFile" multiple accept="image/*">
        <div class="file-input-label"><span>üì∑</span><span id="fileName">Pilih gambar bukti lembur...</span></div></div>
      <div class="file-preview" id="filePreview"></div>
    </div>
  </div>
  <div class="button-group">
    <button class="btn-add" onclick="tambahData()">+ Tambah Data</button>
    <button class="btn-export" onclick="exportToExcel()">üì• Export Excel</button>
    <button class="btn-clear" onclick="hapusSemuaData()">üóëÔ∏è Hapus Semua</button>
  </div>
</div>

<div class="table-container">
<table id="tabelLembur"><thead>
<tr><th>No</th><th>Bulan</th><th>Tanggal</th><th>Jam Mulai</th><th>Jam Selesai</th><th>Total Jam</th><th>Pekerjaan</th><th>Bukti</th><th>Aksi</th></tr>
</thead><tbody id="tbody"></tbody></table></div>

<div class="summary">
<div class="summary-item"><label>Total Jam</label><div class="value" id="totalJam">0</div></div>
<div class="summary-item"><label>Jumlah Entri</label><div class="value" id="jumlahEntri">0</div></div>
</div>
</div>

<div class="modal" id="modalBukti">
<div class="modal-content">
<button class="modal-close" onclick="closeModal()">√ó</button>
<h3>Bukti Screenshot</h3>
<div id="modalInfo"></div>
<div class="modal-images" id="modalImages"></div>
</div></div>
<div class="save-indicator" id="saveIndicator">‚úì Data tersimpan otomatis</div>

<script>
let dataLembur = JSON.parse(localStorage.getItem('dataLembur') || '[]');
let currentImages = [];

function showSaveIndicator(){const s=document.getElementById('saveIndicator');s.style.display='block';setTimeout(()=>s.style.display='none',1500);}
function saveData(){localStorage.setItem('dataLembur',JSON.stringify(dataLembur));showSaveIndicator();}
function hitungJam(mulai,selesai){const[mh,mm]=mulai.split(':').map(Number);const[sh,sm]=selesai.split(':').map(Number);let total=(sh*60+sm)-(mh*60+mm);if(total<0)total+=1440;return(total/60).toFixed(2);}
function renderTabel(){
const tbody=document.getElementById('tbody');
if(!dataLembur.length){tbody.innerHTML='<tr><td colspan="9" style="text-align:center;color:#6c757d;">Belum ada data lembur</td></tr>';return;}
tbody.innerHTML=dataLembur.map((d,i)=>`
<tr>
<td>${i+1}</td>
<td>${new Date(d.bulanTahun+'-01').toLocaleDateString('id-ID',{month:'long',year:'numeric'})}</td>
<td>${new Date(d.tanggal).toLocaleDateString('id-ID')}</td>
<td>${d.jamMulai}</td><td>${d.jamSelesai}</td>
<td>${d.totalJam} jam</td>
<td>${d.deskripsi}</td>
<td>${d.bukti?.length?d.bukti.length+' foto':'-'}</td>
<td>${d.bukti?.length?'<button class="btn-view" onclick="lihatBukti('+i+')">Lihat</button>':''}<button class="btn-delete" onclick="hapusData(${i})">Hapus</button></td>
</tr>`).join('');
document.getElementById('totalJam').textContent=dataLembur.reduce((a,b)=>a+parseFloat(b.totalJam),0).toFixed(2);
document.getElementById('jumlahEntri').textContent=dataLembur.length;
}
renderTabel();

document.getElementById('buktiFile').addEventListener('change',e=>{
const files=[...e.target.files];const prev=document.getElementById('filePreview');prev.innerHTML='';currentImages=[];
files.forEach((f,i)=>{const r=new FileReader();r.onload=x=>{
currentImages.push(x.target.result);
const div=document.createElement('div');div.className='preview-item';
div.innerHTML=`<img src="${x.target.result}"><button class="preview-remove" onclick="removeImage(${i})">√ó</button>`;
prev.appendChild(div);};r.readAsDataURL(f);});
document.getElementById('fileName').textContent=files.length?files.length+' gambar dipilih':'Pilih gambar...';
});
function removeImage(i){currentImages.splice(i,1);document.getElementById('filePreview').children[i].remove();}

function tambahData(){
const bulanTahun=document.getElementById('bulanTahun').value,tanggal=document.getElementById('tanggal').value,jamMulai=document.getElementById('jamMulai').value,jamSelesai=document.getElementById('jamSelesai').value,deskripsi=document.getElementById('deskripsi').value;
if(!bulanTahun||!tanggal||!jamMulai||!jamSelesai||!deskripsi){alert('Lengkapi semua kolom!');return;}
const totalJam=hitungJam(jamMulai,jamSelesai);
dataLembur.push({bulanTahun,tanggal,jamMulai,jamSelesai,totalJam,deskripsi,bukti:[...currentImages]});
saveData();renderTabel();
document.querySelectorAll('#jamMulai,#jamSelesai,#deskripsi,#buktiFile').forEach(e=>e.value='');
document.getElementById('filePreview').innerHTML='';document.getElementById('fileName').textContent='Pilih gambar bukti lembur...';currentImages=[];
}
function hapusData(i){if(confirm('Hapus entri ini?')){dataLembur.splice(i,1);saveData();renderTabel();}}
function hapusSemuaData(){if(confirm('Hapus semua data?')){dataLembur=[];saveData();renderTabel();}}
function lihatBukti(i){const d=dataLembur[i];const m=document.getElementById('modalBukti');document.getElementById('modalInfo').innerHTML=`
<p><strong>Tanggal:</strong> ${new Date(d.tanggal).toLocaleDateString('id-ID')}</p>
<p><strong>Waktu:</strong> ${d.jamMulai} - ${d.jamSelesai}</p><p><strong>Pekerjaan:</strong> ${d.deskripsi}</p>`;
document.getElementById('modalImages').innerHTML=d.bukti.map(x=>`<img src="${x}">`).join('');m.classList.add('active');}
function closeModal(){document.getElementById('modalBukti').classList.remove('active');}

function exportToExcel(){
if(!dataLembur.length){alert('Tidak ada data!');return;}
let html=`<table border="1"><tr><th>No</th><th>Bulan</th><th>Tanggal</th><th>Jam Mulai</th><th>Jam Selesai</th><th>Total Jam</th><th>Pekerjaan</th><th>Jumlah Foto</th></tr>`;
dataLembur.forEach((d,i)=>{
html+=`<tr><td>${i+1}</td><td>${new Date(d.bulanTahun+'-01').toLocaleDateString('id-ID',{month:'long',year:'numeric'})}</td>
<td>${new Date(d.tanggal).toLocaleDateString('id-ID')}</td><td>${d.jamMulai}</td><td>${d.jamSelesai}</td>
<td>${d.totalJam}</td><td>${d.deskripsi}</td><td>${d.bukti?.length||0}</td></tr>`;});
html+='</table>';
const blob=new Blob([html],{type:'application/vnd.ms-excel'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='Laporan_Lembur.xls';a.click();
}
</script>
</body>
</html>
